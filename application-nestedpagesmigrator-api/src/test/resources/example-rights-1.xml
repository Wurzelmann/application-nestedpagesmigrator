<!--
  Example with rights.
-->
<example>
  <!-- State before the migration -->
  <before>
    <rights>
      <right>
        <group>XWiki.AllGroup</group>
        <level>view,edit,comment,create,register</level>
        <value>allow</value>
        <from>XWiki.XWikiPreferences</from>
      </right>
      <right>
        <group>XWiki.AdminGroup</group>
        <level>admin,programing</level>
        <value>allow</value>
        <from>XWiki.XWikiPreferences</from>
      </right>
      <right>
        <user>XWiki.Shakespeare</user>
        <level>admin</level>
        <value>allow</value>
        <from>XWiki.XWikiPreferences</from>
      </right>
      <right>
        <user>XWiki.Dostoievski</user>
        <level>comment</level>
        <value>deny</value>
        <from>XWiki.XWikiPreferences</from>
      </right>
    </rights>
    <page>
      <fullName>Main.WebHome</fullName>
      <parent/>
    </page>
    <page>
      <fullName>Movies.WebHome</fullName>
      <parent>Main.WebHome</parent>
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>comment</level>
          <value>deny</value>
          <from>Movies.WebPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>delete</level>
          <value>allow</value>
          <from>Movies.WebPreferences</from>
        </right>
      </rights>
    </page>
    <page>
      <fullName>Movies.DancesWithWolves</fullName>
      <parent>Movies.WebHome</parent>
    </page>
    <!-- Star trek will now have rights from Movies...-->
    <page>
      <fullName>Main.StarTrek</fullName>
      <parent>Movies.WebHome</parent>
    </page>
    <page>
      <fullName>Dramas.WebHome</fullName>
      <parent>Movies.WebHome</parent>
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>create</level>
          <value>deny</value>
          <from>Dramas.WebPreferences</from>
        </right>
        <right>
          <user>XWiki.Dostoievski</user>
          <level>comment</level>
          <value>allow</value>
          <from>Dramas.WebPreferences</from>
        </right>
      </rights>
    </page>
    <!-- The rights for The Hours can be lost! -->
    <page>
      <fullName>Dramas.TheHours</fullName>
      <parent>Movies.WebHome</parent>
    </page>
  </before>
  <!-- Expected state after the migration -->
  <after>
    <page>
      <fullName>Main.WebHome</fullName>
      <from>Main.WebHome</from>
    </page>
    <page>
      <fullName>Main.Movies.WebHome</fullName>
      <from>Movies.WebHome</from>
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>comment</level>
          <value>deny</value>
          <from>Movies.WebPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>delete</level>
          <value>allow</value>
          <from>Movies.WebPreferences</from>
        </right>
      </rights>
    </page>
    <page>
      <fullName>Main.Movies.DancesWithWolves.WebHome</fullName>
      <from>Movies.DancesWithWolves</from>
    </page>
    <page>
      <fullName>Main.Movies.StarTrek.WebHome</fullName>
      <from>Main.StarTrek</from>
      <!-- Dismiss the Movies rights -->
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>comment</level>
          <value>allow</value>
          <from>XWiki.XWikiPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>delete</level>
          <value>deny</value>
          <from>Movies.WebPreferences</from>
        </right>
      </rights>
    </page>
    <page>
      <fullName>Main.Movies.Dramas.WebHome</fullName>
      <from>Dramas.WebHome</from>
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>create</level>
          <value>deny</value>
          <from>Dramas.WebPreferences</from>
        </right>
        <right>
          <user>XWiki.Dostoievski</user>
          <level>comment</level>
          <value>allow</value>
          <from>Dramas.WebPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>comment</level>
          <value>allow</value>
          <from>XWiki.XWikiPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>delete</level>
          <value>deny</value>
          <from>Movies.WebPreferences</from>
        </right>
      </rights>
    </page>
    <page>
      <fullName>Main.Movies.TheHours.WebHome</fullName>
      <from>Dramas.TheHours</from>
      <!-- Comes from Dramas.WebHome -->
      <rights>
        <right>
          <group>XWiki.AllGroup</group>
          <level>create</level>
          <value>deny</value>
          <from>Dramas.WebPreferences</from>
        </right>
        <right>
          <user>XWiki.Dostoievski</user>
          <level>comment</level>
          <value>allow</value>
          <from>Dramas.WebPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>comment</level>
          <value>allow</value>
          <from>XWiki.XWikiPreferences</from>
        </right>
        <right>
          <group>XWiki.AllGroup</group>
          <level>delete</level>
          <value>deny</value>
          <from>Movies.WebPreferences</from>
        </right>
      </rights>
    </page>
  </after>
  <!-- Plan as JSON -->
  <plan><![CDATA[
[
  {
    "sourceDocument": "xwiki:Main.WebHome",
    "targetDocument": "xwiki:Main.WebHome",
    "children": [
      {
        "sourceDocument": "xwiki:Movies.WebHome",
        "targetDocument": "xwiki:Main.Movies.WebHome",
        "rights": [
          {
            "group": "xwiki:XWiki.AllGroup",
            "level": "comment",
            "allow": false,
            "from": "xwiki:Movies.WebPreferences"
          },
          {
            "group": "xwiki:XWiki.AllGroup",
            "level": "delete",
            "allow": true,
            "from": "xwiki:Movies.WebPreferences"
          }
        ],
        "children": [
          {
            "sourceDocument": "xwiki:Movies.DancesWithWolves",
            "targetDocument": "xwiki:Main.Movies.DancesWithWolves.WebHome"
          },
          {
            "sourceDocument": "xwiki:Main.StarTrek",
            "targetDocument": "xwiki:Main.Movies.StarTrek.WebHome",
            "rights": [
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "comment",
                "allow": true,
                "from": "xwiki:XWiki.XWikiPreferences"
              },
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "delete",
                "allow": false,
                "from": "xwiki:Movies.WebPreferences"
              }
            ]
          },
          {
            "sourceDocument": "xwiki:Dramas.WebHome",
            "targetDocument": "xwiki:Main.Movies.Dramas.WebHome",
            "rights": [
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "create",
                "allow": false,
                "from": "xwiki:Dramas.WebPreferences"
              },
              {
                "user": "xwiki:XWiki.Dostoievski",
                "level": "comment",
                "allow": true,
                "from": "xwiki:Dramas.WebPreferences"
              },
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "comment",
                "allow": true,
                "from": "xwiki:XWiki.XWikiPreferences"
              },
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "delete",
                "allow": false,
                "from": "xwiki:Movies.WebPreferences"
              }
            ]
          },
          {
            "sourceDocument": "xwiki:Dramas.TheHours",
            "targetDocument": "xwiki:Main.Movies.TheHours.WebHome",
            "rights": [
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "create",
                "allow": false,
                "from": "xwiki:Dramas.WebPreferences"
              },
              {
                "user": "xwiki:XWiki.Dostoievski",
                "level": "comment",
                "allow": true,
                "from": "xwiki:Dramas.WebPreferences"
              },
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "comment",
                "allow": true,
                "from": "xwiki:XWiki.XWikiPreferences"
              },
              {
                "group": "xwiki:XWiki.AllGroup",
                "level": "delete",
                "allow": false,
                "from": "xwiki:Movies.WebPreferences"
              }
            ]
          }
        ]
      }
    ]
  }
]
]]></plan>
</example>
